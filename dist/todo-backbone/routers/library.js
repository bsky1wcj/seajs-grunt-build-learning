define("dist/todo-backbone/routers/library",["gallery/backbone/1.1.0/backbone","gallery/underscore/1.5.2/underscore","$","../collections/library","../models/book","../views/book","jquery/jquery/1.10.1/jquery","../views/library","../views/add-book","../views/edit-book"],function(a,b,c){var d=a("gallery/backbone/1.1.0/backbone"),e=a("../collections/library"),f=a("../models/book"),g=(a("../views/book"),a("../views/library")),h=a("../views/add-book"),i=a("../views/edit-book"),j=d.Router.extend({routes:{"":"index","library/index":"index","book/add":"create","book/:id/edit":"edit","book/:id/view":"show"},initialize:function(){console.log("LibraryRouter-initialize")},create:function(){console.log("create"),this.bookView&&this.bookView.close(),this.bookView=new h({collection:this.bookList,model:new f}),this.bookView.render().el},edit:function(a){console.log("edit"),this.bookList?(this.bookView&&this.bookView.close(),this.bookView=new i({model:this.bookList.get(a)}),this.bookView.render().el):(this.requestedId=a,this.index())},index:function(){console.log("index"),this.bookList&&(this.requestedId=null);var a=this;this.bookList=e,this.bookList.fetch({success:function(){a.libraryView=new g({collection:a.bookList}),a.libraryView.render().el,a.requestedId&&a.edit(a.requestedId)}})}});c.exports=j}),define("dist/todo-backbone/collections/library",["gallery/backbone/1.1.0/backbone","gallery/underscore/1.5.2/underscore","$","dist/todo-backbone/models/book"],function(a,b,c){var d=a("gallery/backbone/1.1.0/backbone"),e=a("dist/todo-backbone/models/book"),f=d.Collection.extend({url:"server/list.php",model:e,initialize:function(){console.log("LibraryCollection-initialize")}});c.exports=new f}),define("dist/todo-backbone/models/book",["gallery/backbone/1.1.0/backbone","gallery/underscore/1.5.2/underscore","$"],function(a,b,c){var d=a("gallery/backbone/1.1.0/backbone"),e=a("gallery/underscore/1.5.2/underscore"),f=d.Model.extend({initialize:function(){console.log("BookModel-initialize")},defaults:{id:null,title:"",author:"",description:""},validate:function(a){console.log("BookModel-validate===============");var b={};return""===a.title&&(b.title="title 不能为空！"),""===a.author&&(b.author="author 不能为空！"),""===a.description&&(b.description="description 不能为空！"),e.isEmpty(b)?void 0:b}});c.exports=f}),define("dist/todo-backbone/views/book",["gallery/backbone/1.1.0/backbone","gallery/underscore/1.5.2/underscore","$","jquery/jquery/1.10.1/jquery"],function(a,b,c){var d=a("gallery/backbone/1.1.0/backbone"),e=a("jquery/jquery/1.10.1/jquery"),f=a("gallery/underscore/1.5.2/underscore"),g=d.View.extend({tagName:"tr",className:"bookContainer",template:e("#rowTemplate").html(),events:{"click .delete":"destroy"},initialize:function(a){console.log("BookView-initialize",a.model.id),this.collection=a.collection,this.model=a.model,f.bindAll(this,"render","destroy")},render:function(){console.log("BookView-render");var a=f.template(this.template);return this.$el.html(a(this.model.toJSON())),this},destroy:function(a){var b=this,c=this.model.get("id");a.preventDefault(),a.stopPropagation(),confirm("Are you sure?")&&this.model.destroy({type:"GET",url:"server/delete.php",data:e.param({id:c}),success:function(a,c){console.log("success",a,c),b.remove()},error:function(a,b){console.log("error",a,b)}})}});c.exports=g}),define("dist/todo-backbone/views/library",["gallery/backbone/1.1.0/backbone","gallery/underscore/1.5.2/underscore","$","jquery/jquery/1.10.1/jquery","dist/todo-backbone/views/book"],function(a,b,c){var d=a("gallery/backbone/1.1.0/backbone"),e=a("jquery/jquery/1.10.1/jquery"),f=a("gallery/underscore/1.5.2/underscore"),g=a("dist/todo-backbone/views/book"),h=d.View.extend({el:"#library",events:{"click #add":"addBook"},libraryTemplate:e("#indexTemplate").html(),updateDebug:function(){e("#output").text(JSON.stringify(this.collection.toJSON(),null,4))},initialize:function(){console.log("LibraryView-initialize"),this.collection.bind("reset",this.render,this),this.collection.bind("all",this.updateDebug,this),this.collection.comparator=function(a){return a.get("title")}},render:function(){return console.log("LibraryView-render"),this.$el.html(this.libraryTemplate),this.addAll(),this},addAll:function(){console.log("addAll",this.collection),this.$el.find("tbody").children().remove(),f.each(this.collection.models,e.proxy(this,"addOne"))},addOne:function(a){console.log("addOne");var b=new g({collection:this.collection,model:a});this.$el.find("tbody").append(b.render().el)}});c.exports=h}),define("dist/todo-backbone/views/add-book",["gallery/backbone/1.1.0/backbone","gallery/underscore/1.5.2/underscore","$","jquery/jquery/1.10.1/jquery"],function(a,b,c){var d=a("gallery/backbone/1.1.0/backbone"),e=a("jquery/jquery/1.10.1/jquery"),f=a("gallery/underscore/1.5.2/underscore"),g=d.View.extend({el:"#library",className:"addBookContainer",template:e("#formTemplate").html(),events:{"click .save":"save"},initialize:function(a){console.log("AddBookView-initialize"),this.collection=a.collection,this.model=a.model,this.model.bind("invalid",this.showErrors,this)},showErrors:function(a,b){this.$el.find(".has-error").removeClass("has-error"),this.$el.find(".alert").html(f.values(b).join("<br>")).show(),f.each(f.keys(b),f.bind(function(a){this.$el.find("*[name="+a+"]").parent().addClass("has-error")},this))},render:function(){var a=f.template(this.template);return this.$el.html(a(this.model.toJSON())),this.$el.find("h2").text("Create New Book"),this},close:function(){this.$el.unbind(),this.$el.empty()},save:function(a){{var b=this;this.model.get("id")}a.preventDefault(),a.stopPropagation(),this.model.set({title:this.$el.find("input[name=title]").val(),author:this.$el.find("input[name=author]").val(),description:this.$el.find("textarea[name=description]").val()}),this.model.save(null,{type:"GET",url:"server/add.php",data:e.param(this.model.toJSON()),success:function(){b.collection.add(b.model),window.location.hash="library/index"},error:function(a,b){console.log("error",a,b)}})}});c.exports=g}),define("dist/todo-backbone/views/edit-book",["gallery/backbone/1.1.0/backbone","gallery/underscore/1.5.2/underscore","$","jquery/jquery/1.10.1/jquery"],function(a,b,c){var d=a("gallery/backbone/1.1.0/backbone"),e=a("jquery/jquery/1.10.1/jquery"),f=a("gallery/underscore/1.5.2/underscore"),g=d.View.extend({el:"#library",className:"editBookContainer",template:e("#formTemplate").html(),events:{"click .save":"save"},initialize:function(){console.log("EditBookView-initialize"),this.model.bind("change",this.render,this),this.model.bind("invalid",this.showErrors,this)},showErrors:function(a,b){this.$el.find(".has-error").removeClass("has-error"),this.$el.find(".alert").html(f.values(b).join("<br>")).show(),f.each(f.keys(b),f.bind(function(a){this.$el.find("*[name="+a+"]").parent().addClass("has-error")},this))},render:function(){var a=f.template(this.template);return this.$el.html(a(this.model.toJSON())),this.$el.find("h2").text("Edit Book"),this},close:function(){this.$el.unbind(),this.$el.empty()},save:function(a){console.log("save");var b=this.model.get("id");a.preventDefault(),a.stopPropagation(),this.model.set({title:this.$el.find("input[name=title]").val(),author:this.$el.find("input[name=author]").val(),description:this.$el.find("textarea[name=description]").val(),id:b}),this.model.save(null,{type:"GET",url:"server/add.php",data:e.param(this.model.toJSON()),success:function(a,b){console.log("success",a,b),window.location.hash="library/index"},error:function(a,b){console.log("error",a,b)}})}});c.exports=g});