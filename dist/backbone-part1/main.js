define("dist/backbone-part1/main",["gallery/backbone/1.1.0/backbone","gallery/underscore/1.5.2/underscore","$","jquery/jquery/1.10.1/jquery"],function(a){var b=a("gallery/backbone/1.1.0/backbone"),c=a("jquery/jquery/1.10.1/jquery"),d=a("gallery/underscore/1.5.2/underscore"),e=b.Model.extend({initialize:function(){console.log("BookModel-initialize")},defaults:{id:null,title:"",author:"",description:""}}),f=b.Collection.extend({url:"server/list.php",model:e,initialize:function(){console.log("BookCollection-initialize")}}),g=b.View.extend({el:"#library",events:{"click #add":"addBook"},updateDebug:function(){c("#output").text(JSON.stringify(this.collection.toJSON(),null,4))},initialize:function(a){console.log("BookListView-initialize"),this.collection.bind("reset",this.render,this),this.collection.bind("all",this.updateDebug,this);this.options=a,this.pageSize=a.pageSize,this.len=this.collection.models.length,this.startPos=(a.page-1)*this.pageSize,this.endPos=Math.min(this.startPos+this.pageSize,this.len)},render:function(){return console.log("BookListView-render"),this.$el.html(c("#indexTemplate").html()),this.addAll(),new j({collection:this.collection,page:this.options.page,pageSize:this.options.pageSize}).render().el,this},addAll:function(){console.log("addAll"),this.$el.find("tbody").children().remove();for(var a=this.startPos;a<this.endPos;a++)this.addOne(this.collection.models[a])},addOne:function(a){console.log("addOne");var b=new h({model:a});this.$el.find("tbody").append(b.render().el)},addBook:function(){}}),h=b.View.extend({tagName:"tr",className:"book-list-item",template:d.template(c("#rowTemplate").html()),events:{"click .delete":"deleteBook"},initialize:function(){console.log("BookListItemView-initialize"),this.model.bind("change",this.render,this)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},deleteBook:function(a){var b=this,d=this.model.id;a.preventDefault(),a.stopPropagation(),confirm("Are you sure?")&&this.model.destroy({type:"GET",url:"server/delete.php",data:c.param({id:d}),success:function(a,c){console.log("success",a,c),b.close()},error:function(a,b){console.log("error",a,b)}})},close:function(){c(this.el).unbind(),c(this.el).remove()}}),i=b.View.extend({el:"#library",template:d.template(c("#formTemplate").html()),initialize:function(){console.log("BookView-initialize"),this.model.bind("change",this.render,this)},events:{"change input":"change","click .save":"saveBook","click .delete":"deleteBook"},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},saveBook:function(){if(event.preventDefault(),event.stopPropagation(),this.model.set({title:this.$el.find("input[name=title]").val(),author:this.$el.find("input[name=author]").val(),description:this.$el.find("textarea[name=description]").val()}),console.log(this.model,this.model.isNew()),this.model.isNew()){console.log("add",this.model),this.model.save(null,{type:"GET",url:"server/add.php",data:c.param(this.model.toJSON()),success:function(a,b){console.log("success",a,b),app.navigate("library/index",!0)},error:function(a,b){console.log("error",a,b)}})}else console.log("edit"),this.model.save(null,{type:"GET",url:"server/add.php",data:c.param(this.model.toJSON()),success:function(a,b){console.log("success",a,b),window.history.back()},error:function(a,b){console.log("error",a,b)}});return!1},deleteBook:function(){},close:function(){this.$el.unbind(),this.$el.empty()}}),j=b.View.extend({el:"#libraryPaginator",initialize:function(a){console.log("Paginator-initialize"),this.options=a,this.collection.bind("remove",this.render,this),this.collection.bind("reset",this.render,this)},render:function(){console.log("Paginator-render");var a=this.collection.models,b=a.length,d=Math.ceil(b/2);c(this.el).html('<ul class="pagination pagination-lg"/>');for(var e=0;d>e;e++)this.$el.find("ul").append("<li"+(e+1===this.options.page?" class='active'":"")+"><a href='#library/page/"+(e+1)+"'>"+(e+1)+"</a></li>");return this}}),k=b.Router.extend({routes:{"":"list","library/index":"list","library/page/:page":"list","book/add":"addBook","book/:id":"bookDetails"},initialize:function(){console.log("BookRouter-initialize")},list:function(a){console.log("list"),this.bookList&&(this.requestedId=null);var b=this,c=a?parseInt(a,10):1;this.bookList=new f,this.bookList.fetch({data:{page:c,pageSize:2},success:function(){b.bookListView=new g({collection:b.bookList,page:c,pageSize:2}),b.bookListView.render().el,b.requestedId&&b.bookDetails(b.requestedId)}})},bookDetails:function(a){console.log("bookDetails",a),this.bookList?(this.book=this.bookList.get(a),this.bookView&&this.bookView.close(),this.bookView=new i({model:this.book}),this.bookView.render().el):(this.requestedId=a,this.list())},addBook:function(){this.bookView&&this.bookView.close(),this.bookView=new i({model:new e}),this.bookView.render().el}});window.app=new k,b.history.start()});